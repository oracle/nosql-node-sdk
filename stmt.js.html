<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>stmt.js - Oracle NoSQL Database Node.js SDK</title>
    
    
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-connect-cloud.html">Connecting an Application to Oracle NoSQL Database Cloud Service</a></li><li><a href="tutorial-connect-on-prem.html">Connecting an Application to On-Premise Oracle NoSQL Database</a></li><li><a href="tutorial-tables.html">Working With Tables</a></li></ul><h3>Classes</h3><ul><li><a href="AdminState.html">AdminState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AdminState.html#toString">toString</a></li></ul></li><li><a href="CapacityMode.html">CapacityMode</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CapacityMode.html#toString">toString</a></li></ul></li><li><a href="Consistency.html">Consistency</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Consistency.html#toString">toString</a></li></ul></li><li><a href="Durabilities.html">Durabilities</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Durabilities.html#.create">create</a></li></ul></li><li><a href="Enum.html">Enum</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Enum.html#toString">toString</a></li></ul></li><li><a href="ErrorCode.html">ErrorCode</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ErrorCode.html#toString">toString</a></li></ul></li><li><a href="NoSQLArgumentError.html">NoSQLArgumentError</a></li><li><a href="NoSQLAuthorizationError.html">NoSQLAuthorizationError</a></li><li><a href="NoSQLClient.html">NoSQLClient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="NoSQLClient.html#adminDDL">adminDDL</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#adminStatus">adminStatus</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#close">close</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#deleteIfVersion">deleteIfVersion</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#deleteMany">deleteMany</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#deleteRange">deleteRange</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#forCompletion">forCompletion</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#forTableState">forTableState</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#get">get</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getIndex">getIndex</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getIndexes">getIndexes</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getSerialVersion">getSerialVersion</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getTable">getTable</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getTableUsage">getTableUsage</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#listNamespaces">listNamespaces</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#listRoles">listRoles</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#listTables">listTables</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#listUsers">listUsers</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#precacheAuth">precacheAuth</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#put">put</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#putIfAbsent">putIfAbsent</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#putIfPresent">putIfPresent</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#putIfVersion">putIfVersion</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#putMany">putMany</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#query">query</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#queryIterable">queryIterable</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#setTableLimits">setTableLimits</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#setTableTags">setTableTags</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#tableDDL">tableDDL</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#tableUsageIterable">tableUsageIterable</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#writeMany">writeMany</a></li></ul></li><li><a href="NoSQLError.html">NoSQLError</a></li><li><a href="NoSQLNetworkError.html">NoSQLNetworkError</a></li><li><a href="NoSQLProtocolError.html">NoSQLProtocolError</a></li><li><a href="NoSQLQueryError.html">NoSQLQueryError</a></li><li><a href="NoSQLServiceError.html">NoSQLServiceError</a></li><li><a href="NoSQLTimeoutError.html">NoSQLTimeoutError</a></li><li><a href="NoSQLUnsupportedProtocolError.html">NoSQLUnsupportedProtocolError</a></li><li><a href="PreparedStatement.html">PreparedStatement</a><ul class='methods'><li data-type='method' style='display: none;'><a href="PreparedStatement.html#clearAll">clearAll</a></li><li data-type='method' style='display: none;'><a href="PreparedStatement.html#copyStatement">copyStatement</a></li><li data-type='method' style='display: none;'><a href="PreparedStatement.html#set">set</a></li></ul></li><li><a href="Region.html">Region</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Region.html#toString">toString</a></li></ul></li><li><a href="ReplicaAckPolicy.html">ReplicaAckPolicy</a></li><li><a href="ServiceType.html">ServiceType</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ServiceType.html#toString">toString</a></li></ul></li><li><a href="SimpleRateLimiter.html">SimpleRateLimiter</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SimpleRateLimiter.html#consumeUnits">consumeUnits</a></li><li data-type='method' style='display: none;'><a href="SimpleRateLimiter.html#onThrottle">onThrottle</a></li><li data-type='method' style='display: none;'><a href="SimpleRateLimiter.html#setLimit">setLimit</a></li></ul></li><li><a href="SyncPolicy.html">SyncPolicy</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SyncPolicy.html#toString">toString</a></li></ul></li><li><a href="TableState.html">TableState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="TableState.html#toString">toString</a></li></ul></li><li><a href="TTLUtil.html">TTLUtil</a><ul class='methods'><li data-type='method' style='display: none;'><a href="TTLUtil.html#.fromExpirationTime">fromExpirationTime</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.ofDays">ofDays</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.ofHours">ofHours</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toDays">toDays</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toExpirationTime">toExpirationTime</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toExpirationTimeMillis">toExpirationTimeMillis</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toHours">toHours</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toMillis">toMillis</a></li></ul></li></ul><h3>Interfaces</h3><ul><li><a href="RateLimiter.html">RateLimiter</a><ul class='methods'><li data-type='method' style='display: none;'><a href="RateLimiter.html#consumeUnits">consumeUnits</a></li><li data-type='method' style='display: none;'><a href="RateLimiter.html#onThrottle">onThrottle</a></li><li data-type='method' style='display: none;'><a href="RateLimiter.html#setLimit">setLimit</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="NoSQLClient.html#event:consumedCapacity">consumedCapacity</a></li><li><a href="NoSQLClient.html#event:error">error</a></li><li><a href="NoSQLClient.html#event:retryable">retryable</a></li><li><a href="NoSQLClient.html#event:tableState">tableState</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AdminResult">AdminResult</a></li><li><a href="global.html#AuthConfig">AuthConfig</a></li><li><a href="global.html#AuthorizationProvider">AuthorizationProvider</a></li><li><a href="global.html#Config">Config</a></li><li><a href="global.html#ConsumedCapacity">ConsumedCapacity</a></li><li><a href="global.html#ContinuationKey">ContinuationKey</a></li><li><a href="global.html#DBNumberConfig">DBNumberConfig</a></li><li><a href="global.html#DefinedTags">DefinedTags</a></li><li><a href="global.html#delay">delay</a></li><li><a href="global.html#DelegationTokenProvider">DelegationTokenProvider</a></li><li><a href="global.html#DeleteResult">DeleteResult</a></li><li><a href="global.html#doRetry">doRetry</a></li><li><a href="global.html#Durability">Durability</a></li><li><a href="global.html#FieldRange">FieldRange</a></li><li><a href="global.html#FieldValue">FieldValue</a></li><li><a href="global.html#FreeFormTags">FreeFormTags</a></li><li><a href="global.html#getAuthorization">getAuthorization</a></li><li><a href="global.html#GetResult">GetResult</a></li><li><a href="global.html#IAMConfig">IAMConfig</a></li><li><a href="global.html#IAMCredentials">IAMCredentials</a></li><li><a href="global.html#IAMCredentialsProvider">IAMCredentialsProvider</a></li><li><a href="global.html#IndexInfo">IndexInfo</a></li><li><a href="global.html#Key">Key</a></li><li><a href="global.html#KVStoreAuthConfig">KVStoreAuthConfig</a></li><li><a href="global.html#KVStoreCredentials">KVStoreCredentials</a></li><li><a href="global.html#KVStoreCredentialsProvider">KVStoreCredentialsProvider</a></li><li><a href="global.html#ListTablesResult">ListTablesResult</a></li><li><a href="global.html#loadDelegationToken">loadDelegationToken</a></li><li><a href="global.html#loadIAMCredentials">loadIAMCredentials</a></li><li><a href="global.html#loadKVStoreCredentials">loadKVStoreCredentials</a></li><li><a href="global.html#MultiDeleteResult">MultiDeleteResult</a></li><li><a href="global.html#NumberLibConfig">NumberLibConfig</a></li><li><a href="global.html#NumberLibMethods">NumberLibMethods</a></li><li><a href="global.html#NumberLibPrecision">NumberLibPrecision</a></li><li><a href="global.html#NumberLibRoundingMode">NumberLibRoundingMode</a></li><li><a href="global.html#Operation">Operation</a></li><li><a href="global.html#PrepareResult">PrepareResult</a></li><li><a href="global.html#PutResult">PutResult</a></li><li><a href="global.html#QueryResult">QueryResult</a></li><li><a href="global.html#RetryConfig">RetryConfig</a></li><li><a href="global.html#RetryHandler">RetryHandler</a></li><li><a href="global.html#RoundingModesMap">RoundingModesMap</a></li><li><a href="global.html#Row">Row</a></li><li><a href="global.html#TableETag">TableETag</a></li><li><a href="global.html#TableLimits">TableLimits</a></li><li><a href="global.html#TableResult">TableResult</a></li><li><a href="global.html#TableUsage">TableUsage</a></li><li><a href="global.html#TableUsageResult">TableUsageResult</a></li><li><a href="global.html#TimeToLive">TimeToLive</a></li><li><a href="global.html#UserInfo">UserInfo</a></li><li><a href="global.html#Version">Version</a></li><li><a href="global.html#WriteMultipleResult">WriteMultipleResult</a></li><li><a href="global.html#WriteOperation">WriteOperation</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">stmt.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*-
 * Copyright (c) 2018, 2023 Oracle and/or its affiliates. All rights reserved.
 *
 * Licensed under the Universal Permissive License v 1.0 as shown at
 *  https://oss.oracle.com/licenses/upl/
 */

'use strict';

const isPosInt = require('./utils').isPosInt;
const NoSQLArgumentError = require('./error').NoSQLArgumentError;

/**
 * Defines classes related to SQL statement and query execution such as
 * {@link PreparedStatement}.
 */

/**
 * @classdesc  A class encapsulating a prepared query statement. It includes
 * state that can be sent to a server and executed without re-parsing the
 * query. It includes bind variables which may be set for each successive use
 * of the query.  PreparedStatement object is returned as a result of
 * {@link NoSQLClient#prepare} method.  It can be passed to
 * {@link NoSQLClient#query} and {@link NoSQLClient#queryIterable} methods for
 * execution and be reused for multiple queries, potentially with different
 * values of bind variables.
 * &lt;p>
 * You may share an instance of {@link PreparedStatements} by queries running
 * async-concurrently, e.g. queries invoked concurrently by different async
 * functions.  This is referred to as async-safety:
 * &lt;br>
 * An instance of {@link PreparedStatement} is async-safe if bind variables
 * are not used.  If bind variables are used, it is not async-safe.  In this
 * case, you can construct additional instances of {@link PreparedStatement}
 * using {@link PreparedStatement#copyStatement} method in order to share it
 * among async-concurrent queries.
 * @extends {PrepareResult}
 * @hideconstructor
 */
class PreparedStatement {

    /**
     * Sets and gets the bindings object explicitly.  Bindings object is an
     * object which properties contain the bind variables for this prepared
     * statement.  For each variable, binding object has property which name
     * is the variable name and the value is the variable value.  Note that
     * "$" in the variable name is included in its property name.  For
     * positional variables, the names are determined by the query engine.
     * @type {object}
     * @example //Setting bindings
     * prepStmt.bindings = {
     *     $id: 100,
     *     $name: 'John'
     * };
     * //This is equivalent to:
     * prepStmt.set('$id', 100);
     * prepStmt.set('$name', 'John');
     */
    set bindings(value) {
        this._bindings = value;
    }

    get bindings() {
        return this._bindings;
    }

    /**
     * Binds a variable to use for the query.  The variable can be identified
     * either by its name or its position.
     * &lt;p>
     * To bind by name, pass a name of the variable as it was declared in
     * &lt;em>DECLARE&lt;/em> statement of the query.
     * &lt;p>
     * You can also bind a variable by its position within the query string.
     * The positions start at 1. The variable that appears first in the query
     * text has position 1, the variable that appears second has position 2
     * and so on.  Binding by position is useful for queries where bind
     * variables identified by "?" are used instead of named variables (but it
     * can be used for both types of variables).
     * &lt;p>
     * Existing variables with the same name or position are silently
     * overwritten. The names, positions and types are validated when the
     * query is executed.
     * 
     * @example // Using PreparedStatement, binding variables by name.
     * let client = new NoSQLClient(//.....
     * let prepStmt = await client.prepare(
     *     'DECLARE $id INTEGER; $sal DOUBLE;  SELECT id, firstName, lastName ' +
     *     'FROM Emp WHERE id &lt;= $id AND salary &lt;= $sal');
     * ps.set('$id', 1100);
     *   .set('$sal', 100500);
     * for await(const res of client.queryIterable(stmt)) {
     * //.....
     * }
     * ps.set('$id', 2000);
     * for await(const res of client.queryIterable(stmt)) {
     * //.....
     * }
     * //.....
     * @example // Binding variables by position.
     * let prepStmt = await client.prepare(
     *     'SELECT id, firstName, lastName FROM Emp WHERE ' + 
     *     'id &lt;= ? AND salary &lt;= ?');
     * ps.set(1, 1100)
     *   .set(2, 100500);
     * //.....
     * @param {string|number} nameOrPosition Name or position of the variable
     * @param {FieldValue} val Value of the variable of the appropriate type
     * @returns {PreparedStatement} This instance for chaining
     * @throws {NoSQLArgumentError} If binding by position and the position is
     * invalid.
     */
    set(nameOrPosition, val) {
        if (!this._bindings) {
            this._bindings = {};
        }

        let key = nameOrPosition;
        if (typeof key === 'number') {
            if (!isPosInt(key)) {
                throw new NoSQLArgumentError(
                    `Invalid bind variable position: ${key}`);
            }
            if (this._varNames == null) {
                key = '#' + key;
            } else {
                if (key > this._varNames.length) {
                    throw new NoSQLArgumentError(`Invalid bind variable \
position: ${key}, exceeds total ${this._varNames.length}`);
                }
                key = this._varNames[key];
            }
        }

        this._bindings[key] = val;
        return this;
    }

    /**
     * Clears all variables in bindings for this prepared statement.
     * @returns {PreparedStatement} This instance for chaining
     */
    clearAll() {
        delete this._bindings;
        return this;
    }

    /**
     * SQL text of this prepared statement.
     * @type {string}
     * @readonly
     */
    get sql() {
        return this._sql;
    }

    /**
     * Query execution plan printout if was requested by
     * {@link NoSQLClient#prepare} (see &lt;em>opt.getQueryPlan&lt;/em>), otherwise
     * undefined.
     * @type {string}
     * @readonly
     */
    get queryPlan() {
        return this._queryPlanStr;
    }

    /**
     * JSON representation of the query result schema if was requested by
     * {@link NoSQLClient#prepare} (see &lt;em>opt.getResultSchema&lt;/em>),
     * otherwise undefined.
     * @type {string}
     * @readonly
     */
    get resultSchema() {
        return this._schema;
    }

    /**
     * Returns a copy of this prepared statement without its variables.
     * &lt;p>
     * This method returns a new instance of {@link PreparedStatement} that
     * shares this object's prepared query, which is immutable, but does not
     * share its variables.  Use this method when you need to execute the same
     * prepared query async-concurrently (call this method to create a new copy
     * for each additional concurrent query).
     * @returns {PreparedStatement} A copy of this prepared statement without
     * its variables
     */
    copyStatement() {
        const res = Object.assign({ __proto__: PreparedStatement.prototype },
            this);
        delete res._bindings;
        return res;
    }
}

module.exports = {
    PreparedStatement
};
</code></pre>
        </article>
    </section>





    
</div>

<br class="clear">

<footer>
Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
