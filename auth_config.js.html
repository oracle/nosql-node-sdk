<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>auth/config.js - Oracle NoSQL Database Node.js SDK</title>
    
    
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-connect-cloud.html">Connecting an Application to Oracle NoSQL Database Cloud Service</a></li><li><a href="tutorial-connect-on-prem.html">Connecting an Application to On-Premise Oracle NoSQL Database</a></li><li><a href="tutorial-tables.html">Working With Tables</a></li></ul><h3>Classes</h3><ul><li><a href="AdminState.html">AdminState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AdminState.html#toString">toString</a></li></ul></li><li><a href="CapacityMode.html">CapacityMode</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CapacityMode.html#toString">toString</a></li></ul></li><li><a href="Consistency.html">Consistency</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Consistency.html#toString">toString</a></li></ul></li><li><a href="Durabilities.html">Durabilities</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Durabilities.html#.create">create</a></li></ul></li><li><a href="Enum.html">Enum</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Enum.html#toString">toString</a></li></ul></li><li><a href="ErrorCode.html">ErrorCode</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ErrorCode.html#toString">toString</a></li></ul></li><li><a href="NoSQLArgumentError.html">NoSQLArgumentError</a></li><li><a href="NoSQLAuthorizationError.html">NoSQLAuthorizationError</a></li><li><a href="NoSQLClient.html">NoSQLClient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="NoSQLClient.html#adminDDL">adminDDL</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#adminStatus">adminStatus</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#close">close</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#deleteIfVersion">deleteIfVersion</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#deleteMany">deleteMany</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#deleteRange">deleteRange</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#forCompletion">forCompletion</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#forTableState">forTableState</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#get">get</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getIndex">getIndex</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getIndexes">getIndexes</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getSerialVersion">getSerialVersion</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getTable">getTable</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#getTableUsage">getTableUsage</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#listNamespaces">listNamespaces</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#listRoles">listRoles</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#listTables">listTables</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#listUsers">listUsers</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#precacheAuth">precacheAuth</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#put">put</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#putIfAbsent">putIfAbsent</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#putIfPresent">putIfPresent</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#putIfVersion">putIfVersion</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#putMany">putMany</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#query">query</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#queryIterable">queryIterable</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#setTableLimits">setTableLimits</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#setTableTags">setTableTags</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#tableDDL">tableDDL</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#tableUsageIterable">tableUsageIterable</a></li><li data-type='method' style='display: none;'><a href="NoSQLClient.html#writeMany">writeMany</a></li></ul></li><li><a href="NoSQLError.html">NoSQLError</a></li><li><a href="NoSQLNetworkError.html">NoSQLNetworkError</a></li><li><a href="NoSQLProtocolError.html">NoSQLProtocolError</a></li><li><a href="NoSQLQueryError.html">NoSQLQueryError</a></li><li><a href="NoSQLServiceError.html">NoSQLServiceError</a></li><li><a href="NoSQLTimeoutError.html">NoSQLTimeoutError</a></li><li><a href="NoSQLUnsupportedProtocolError.html">NoSQLUnsupportedProtocolError</a></li><li><a href="PreparedStatement.html">PreparedStatement</a><ul class='methods'><li data-type='method' style='display: none;'><a href="PreparedStatement.html#clearAll">clearAll</a></li><li data-type='method' style='display: none;'><a href="PreparedStatement.html#copyStatement">copyStatement</a></li><li data-type='method' style='display: none;'><a href="PreparedStatement.html#set">set</a></li></ul></li><li><a href="Region.html">Region</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Region.html#toString">toString</a></li></ul></li><li><a href="ReplicaAckPolicy.html">ReplicaAckPolicy</a></li><li><a href="ServiceType.html">ServiceType</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ServiceType.html#toString">toString</a></li></ul></li><li><a href="SimpleRateLimiter.html">SimpleRateLimiter</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SimpleRateLimiter.html#consumeUnits">consumeUnits</a></li><li data-type='method' style='display: none;'><a href="SimpleRateLimiter.html#onThrottle">onThrottle</a></li><li data-type='method' style='display: none;'><a href="SimpleRateLimiter.html#setLimit">setLimit</a></li></ul></li><li><a href="SyncPolicy.html">SyncPolicy</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SyncPolicy.html#toString">toString</a></li></ul></li><li><a href="TableState.html">TableState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="TableState.html#toString">toString</a></li></ul></li><li><a href="TTLUtil.html">TTLUtil</a><ul class='methods'><li data-type='method' style='display: none;'><a href="TTLUtil.html#.fromExpirationTime">fromExpirationTime</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.ofDays">ofDays</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.ofHours">ofHours</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toDays">toDays</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toExpirationTime">toExpirationTime</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toExpirationTimeMillis">toExpirationTimeMillis</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toHours">toHours</a></li><li data-type='method' style='display: none;'><a href="TTLUtil.html#.toMillis">toMillis</a></li></ul></li></ul><h3>Interfaces</h3><ul><li><a href="RateLimiter.html">RateLimiter</a><ul class='methods'><li data-type='method' style='display: none;'><a href="RateLimiter.html#consumeUnits">consumeUnits</a></li><li data-type='method' style='display: none;'><a href="RateLimiter.html#onThrottle">onThrottle</a></li><li data-type='method' style='display: none;'><a href="RateLimiter.html#setLimit">setLimit</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="NoSQLClient.html#event:consumedCapacity">consumedCapacity</a></li><li><a href="NoSQLClient.html#event:error">error</a></li><li><a href="NoSQLClient.html#event:retryable">retryable</a></li><li><a href="NoSQLClient.html#event:tableState">tableState</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AdminResult">AdminResult</a></li><li><a href="global.html#AuthConfig">AuthConfig</a></li><li><a href="global.html#AuthorizationProvider">AuthorizationProvider</a></li><li><a href="global.html#Config">Config</a></li><li><a href="global.html#ConsumedCapacity">ConsumedCapacity</a></li><li><a href="global.html#ContinuationKey">ContinuationKey</a></li><li><a href="global.html#DBNumberConfig">DBNumberConfig</a></li><li><a href="global.html#DefinedTags">DefinedTags</a></li><li><a href="global.html#delay">delay</a></li><li><a href="global.html#DelegationTokenProvider">DelegationTokenProvider</a></li><li><a href="global.html#DeleteResult">DeleteResult</a></li><li><a href="global.html#doRetry">doRetry</a></li><li><a href="global.html#Durability">Durability</a></li><li><a href="global.html#FieldRange">FieldRange</a></li><li><a href="global.html#FieldValue">FieldValue</a></li><li><a href="global.html#FreeFormTags">FreeFormTags</a></li><li><a href="global.html#getAuthorization">getAuthorization</a></li><li><a href="global.html#GetResult">GetResult</a></li><li><a href="global.html#IAMConfig">IAMConfig</a></li><li><a href="global.html#IAMCredentials">IAMCredentials</a></li><li><a href="global.html#IAMCredentialsProvider">IAMCredentialsProvider</a></li><li><a href="global.html#IndexInfo">IndexInfo</a></li><li><a href="global.html#Key">Key</a></li><li><a href="global.html#KVStoreAuthConfig">KVStoreAuthConfig</a></li><li><a href="global.html#KVStoreCredentials">KVStoreCredentials</a></li><li><a href="global.html#KVStoreCredentialsProvider">KVStoreCredentialsProvider</a></li><li><a href="global.html#ListTablesResult">ListTablesResult</a></li><li><a href="global.html#loadDelegationToken">loadDelegationToken</a></li><li><a href="global.html#loadIAMCredentials">loadIAMCredentials</a></li><li><a href="global.html#loadKVStoreCredentials">loadKVStoreCredentials</a></li><li><a href="global.html#MultiDeleteResult">MultiDeleteResult</a></li><li><a href="global.html#NumberLibConfig">NumberLibConfig</a></li><li><a href="global.html#NumberLibMethods">NumberLibMethods</a></li><li><a href="global.html#NumberLibPrecision">NumberLibPrecision</a></li><li><a href="global.html#NumberLibRoundingMode">NumberLibRoundingMode</a></li><li><a href="global.html#Operation">Operation</a></li><li><a href="global.html#PrepareResult">PrepareResult</a></li><li><a href="global.html#PutResult">PutResult</a></li><li><a href="global.html#QueryResult">QueryResult</a></li><li><a href="global.html#RetryConfig">RetryConfig</a></li><li><a href="global.html#RetryHandler">RetryHandler</a></li><li><a href="global.html#RoundingModesMap">RoundingModesMap</a></li><li><a href="global.html#Row">Row</a></li><li><a href="global.html#TableETag">TableETag</a></li><li><a href="global.html#TableLimits">TableLimits</a></li><li><a href="global.html#TableResult">TableResult</a></li><li><a href="global.html#TableUsage">TableUsage</a></li><li><a href="global.html#TableUsageResult">TableUsageResult</a></li><li><a href="global.html#TimeToLive">TimeToLive</a></li><li><a href="global.html#UserInfo">UserInfo</a></li><li><a href="global.html#Version">Version</a></li><li><a href="global.html#WriteMultipleResult">WriteMultipleResult</a></li><li><a href="global.html#WriteOperation">WriteOperation</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">auth/config.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*-
 * Copyright (c) 2018, 2023 Oracle and/or its affiliates. All rights reserved.
 *
 * Licensed under the Universal Permissive License v 1.0 as shown at
 *  https://oss.oracle.com/licenses/upl/
 */

'use strict';

/**
 * Defines types used for NoSQL driver authorization.
 */

/**
 * Authorization configuration for the driver provided as {@link Config}#auth
 * when {@link NoSQLClient} instance is created.
 * &lt;p>
 * Every request to the server made by {@link NoSQLClient} methods requires
 * authorization information.  The way authorization information is obtained
 * depends on the {@link ServiceType} used (set as
 * {@link Config}#serviceType):
 * &lt;ul>
 * &lt;li>For {@link ServiceType.CLOUD}, authorization information is obtained
 * using Oracle Cloud Infrastructure Identity and Access Management (IAM).  To
 * enable authorization, you must set IAM configuration in the form of
 * {@link IAMConfig} as {@link AuthConfig}#iam property.&lt;/li>
 * &lt;li>For {@link ServiceType.CLOUDSIM}, authorization is not required and
 * you do not need to specify {@link Config}#auth property.&lt;/li>
 * &lt;li>For {@link ServiceType.KVSTORE}, if using secure store, you need to
 * specify the store authentication information such as user name and password
 * as {@link AuthConfig}#kvstore property in the form of
 * {@link KVStoreAuthConfig}.  If using non-secure store, authorization is not
 * required and you do not need to specify {@link Config}#auth property.&lt;/li>
 * &lt;li>You may also choose to implement your own authorization provider to
 * obtain authorization information for each request depending on the
 * operation performed.  In this case, set this provider as
 * {@link AuthConfig}#provider property.  If the provider is set,
 * {@link ServiceType} can be undefined, although it may also be possible to
 * have custom provider for existing service types.&lt;/li>
 * &lt;/ul>
 * &lt;p>
 * Note that you may specify both {@link AuthConfig}#iam and
 * {@link AuthConfig}#kvstore in the same configuration object only if
 * {@link Config}#serviceType is set to valid {@link ServiceType}.
 * If {@link Config}#serviceType is not set (in which case the driver will try
 * to deduce service type, see {@link ServiceType}), specifying both
 * {@link AuthConfig}#iam and {@link AuthConfig}#kvstore will
 * result in error.
 * 
 * @see {@link Config}
 * @see {@link ServiceType}
 * @see {@link IAMConfig}
 * @see {@link KVStoreAuthConfig}
 * @see {@link AuthorizationProvider}
 * @tutorial connect-cloud
 * @tutorial connect-on-prem
 * 
 * @example //This AuthConfig object contains required properties to obtain
 * authorization from IAM via OCI configuration file
 * {
 *     iam: {
 *         configFile: '~/myapp/.oci/config',
 *         profileName: 'John'
 *     }
 * };
 * 
 * @example //This AuthConfig object contains required information to connect
 * //to secure kvstore and assumes the user credentials are stored in
 * //separate file credentials.json
 * {
 *     kvstore: {
 *         credentials: '/path/to/credentials.json'
 *     }
 * }
 * 
 * @global
 * @typedef {object} AuthConfig
 * @property {IAMConfig} [iam] IAM configuration, see {@link IAMConfig}.
 * Must be set to use Oracle NoSQL Cloud service
 * @property {KVStoreAuthConfig} [kvstore] Configuration to authenticate with
 * secure On-Premise NoSQL database.  Must be set to connect to secure store
 * @property {AuthorizationProvider} [provider] Custom authorization provider
 */

/**
 * Interface to acquire authorization information.  Authorization information
 * may be returned as a string or as an object:
 * &lt;ul>
 * &lt;li>If represented as a &lt;em>string&lt;/em>, it will be used as a value of HTTP
 * &lt;em>Authorization&lt;/em> header for the service request.&lt;/li>
 * &lt;li>If represented as an &lt;em>object&lt;/em>, this object's properties will be
 * added as HTTP headers for the service request.&lt;/li>
 * &lt;/ul>
 * The specifics depend on the authorization protocol used.
 * 
 * @see {@link AuthorizationProvider}
 * 
 * @global
 * @callback getAuthorization
 * @async
 * @param {Operation} operation NoSQL database operation that requires
 * authorization information, see {@link Operation}
 * @returns {Promise} Promise resolved with authorization &lt;em>string&lt;/em> or
 * authorization &lt;em>object&lt;/em> or rejected with an error
 */

/**
 * AuthorizationProvider is an interface to obtain authorization information
 * for NoSQL database operation.  By default, the driver will use its own
 * authorization providers based on specified {@link ServiceType} and/or
 * presense of service-specific configurations such as {@link IAMConfig} and
 * {@link KVStoreAuthConfig}.  Alternatively, the application may choose to
 * use custom authorization provider and set it as {@link AuthConfig}#provider
 * property.  This custom provider may be specified either as a
 * {@link getAuthorization} function or as an object implementing
 * {@link getAuthorization} function.
 * 
 * @global
 * @typedef {object|getAuthorization} AuthorizationProvider
 * @property {getAuthorization} getAuthorization Retrieves authorization
 * string for an operation
 * @property {function()} [close] If specified, releases any resources
 * associated with this provider when {@link NoSQLClient} instance is closed.
 * Note that this operation may be asynchronous in which case this function
 * should return a &lt;em>Promise&lt;/em> (resolved value is ignored), otherwise
 * return value is ignored.  If error occurs, the function should only log it
 * rather than throwing exception or causing Promise rejection
 */

const assert = require('assert');
const ServiceType = require('../constants').ServiceType;
const NoSQLArgumentError = require('../error').NoSQLArgumentError;
const hasOwnProperty = require('../utils').hasOwnProperty;

class AuthConfig {

    static _str2provider(s) {
        return {
            getAuthorization() {
                return Promise.resolve(s);
            }
        };
    }
    
    static _chkInitProvider(cfg) {
        if (typeof cfg.auth === 'string') {
            cfg.auth = {
                provider: this._str2provider(cfg.auth)
            };
            return;
        }
        if (cfg.auth == null) {
            cfg.auth = {};
            return;
        }
        if (typeof cfg.auth !== 'object') {
            throw new NoSQLArgumentError('Invalid value of auth', cfg);
        }
        if (typeof cfg.auth.provider === 'function') {
            const authProvider = cfg.auth.provider;
            cfg.auth.provider = {
                getAuthorization(req) {
                    return authProvider(req);
                }
            };
            return;
        }
        if (cfg.auth.provider != null &amp;&amp;
            (typeof cfg.auth.provider !== 'object' ||
            typeof cfg.auth.provider.getAuthorization !== 'function')) {
            throw new NoSQLArgumentError('Invalid auth.provider value',
                cfg);
        }
    }

    static _initServiceType(cfg) {
        assert(cfg.auth != null &amp;&amp; typeof cfg.auth === 'object');
        const ownsAuth = hasOwnProperty(cfg, 'auth');
        const isIAM = ownsAuth &amp;&amp; hasOwnProperty(cfg.auth, 'iam');
        const isKVStore = ownsAuth &amp;&amp; hasOwnProperty(cfg.auth, 'kvstore');
        if (isIAM &amp;&amp; isKVStore) {
            throw new NoSQLArgumentError('May not specify multiple \
authorization configurations iam and kvstore without specifying service \
type');
        }
        if (isIAM) {
            if (typeof cfg.auth.iam !== 'object') {
                throw new NoSQLArgumentError('Invalid auth.iam value', cfg);
            }
            cfg.serviceType = ServiceType.CLOUD;
        } else if (isKVStore) {
            if (typeof cfg.auth.kvstore !== 'object') {
                throw new NoSQLArgumentError('Invalid auth.kvstore value',
                    cfg);
            }
            cfg.serviceType = ServiceType.KVSTORE;
        }
        else if (cfg.auth.provider == null) {
            cfg.serviceType = cfg.region == null ? ServiceType.CLOUDSIM :
                ServiceType.CLOUD;
        }
    }

    static init(cfg) {
        this._chkInitProvider(cfg);
        if (cfg.serviceType == null) {
            this._initServiceType(cfg);
        }
        if (cfg.auth.provider != null) {
            return;
        }
        switch(cfg.serviceType) {
        case ServiceType.CLOUDSIM:
            cfg.auth.provider = this._str2provider('Bearer TestTenant');
            break;
        case ServiceType.CLOUD: {
            const IAMAuthorizationProvider = require('./iam/auth_provider');
            cfg.auth.provider = new IAMAuthorizationProvider(cfg);
            break;
        }
        case ServiceType.KVSTORE:
            //Create KVStoreAuthorizationProvider instance if either
            //credentials provider/file or user/password is specified.
            //Otherwise assume this is unsecure kvstore and authorization
            //provider is not needed.
            if (cfg.auth.kvstore != null &amp;&amp;
                (cfg.auth.kvstore.credentials != null ||
                cfg.auth.kvstore.user != null ||
                cfg.auth.kvstore.password != null)) {
                const KVStoreAuthorizationProvider = require(
                    './kvstore/auth_provider');
                cfg.auth.provider = new KVStoreAuthorizationProvider(cfg);
            } else {
                cfg.auth.provider = this._str2provider(null);
            }
            break;
        default:
            assert(cfg.serviceType &amp;&amp; cfg.serviceType._isInternal);
        }
    }

    static close(cfg) {
        assert(cfg.auth &amp;&amp; cfg.auth.provider);
        if (typeof cfg.auth.provider.close === 'function') {
            return cfg.auth.provider.close();
        }
    }

}

AuthConfig.defaults = Object.freeze({
    iam: Object.freeze({
        timeout: 120000,
        refreshAheadMs: 10000,
        //The below properties are not exposed to the user but different
        //values are used in tests.
        securityTokenRefreshAheadMs: 15000,
        securityTokenExpireBeforeMs: 10000
    }),
    kvstore: Object.freeze({
        timeout: 30000,
        autoRenew: true
    })
});

module.exports = AuthConfig;
</code></pre>
        </article>
    </section>





    
</div>

<br class="clear">

<footer>
Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
